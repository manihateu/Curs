// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Файл: schema.prisma

// Таблица для хранения информации об архиве
model Archive {
  id        Int        @id @default(autoincrement())
  shelf     Int
  rack      Int
  cell      Int
  cellCode  String     @unique
  filling   Boolean
  documents Document[]
  createdAt DateTime
}

// Таблица для хранения информации об абонентах архива
model Subscriber {
  id           Int           @id @default(autoincrement())
  fullName     String
  department   String
  phone        String
  receivedDate DateTime
  documents    Document[]
  IssueRecord  IssueRecord[]
}

// Таблица для хранения информации о документах в архиве
model Document {
  id              Int              @id @default(autoincrement())
  title           String
  theme           String
  inventoryNumber String
  cellCode        String
  quantity        Int
  arrivalDate     DateTime
  issueRecords    IssueRecord[]
  archive         Archive          @relation(fields: [cellCode], references: [cellCode])
  subscriber      Subscriber       @relation(fields: [id], references: [id])
  UnusedDocument  UnusedDocument[]
}

// Таблица для хранения записей о выдаче документов
model IssueRecord {
  id           Int        @id @default(autoincrement())
  issueDate    DateTime
  document     Document   @relation(fields: [documentId], references: [id])
  documentId   Int
  subscriber   Subscriber @relation(fields: [subscriberId], references: [id])
  subscriberId Int
}

// Таблица для хранения документов, не востребованных в течение заданного срока
model UnusedDocument {
  id           Int      @id @default(autoincrement())
  document     Document @relation(fields: [documentId], references: [id])
  lastUsedDate DateTime
  documentId   Int
}
